---
id: '04'
title: 04. 엔티티 매핑
---


## 들어가며

### JPA 에서 중요하게 봐야하는 것들

- 객체랑 엔티티를 어떻게 맵핑할지
- 영속성 컨텍스트

### 엔티티 매핑 소개

- 객체와 테이블 매핑: `@Entity`, `@Table`
- 필드와 컬럼 매핑: `@Column`
- 기본 키 매핑: `@Id`
- 연관관계 매핑: `@ManyToOne`, `@JoinColumn`
  - 다음 장에서 알아볼 예정

## 객체와 테이블 매핑

### `@Entity`

- 해당 어노테이션이 붙은 클래스는 JPA 가 관리
- JPA를 사용해서 테이블과 매핑하려면 @Entity 붙임
- 주의
  - 기본 생성자 필수 (파라미터 없는 public or protected 생성자)
    - 스펙상 그럼 (리플렉션등 에 필요..)
  - final, enum, interface, inner 클래스 사용 X
  - 저장할 필드에 final X

### `@Table`

- 엔티티와 매핑할 테이블 지정
  - arguments
    - name: 매핑할 테이블 이름이 다를 때 지정
    - 나머진 뒤에서 설명

## DB 스키마 자동 생성

- DDL을 앱 실행 시점에 자동 생성
  - 운영단계에서 사용하면 안됨..
  - 개발단계에서 로컬 PC에서 사용하길 권장
- 테이블 중심 -> 객체 중심 을 위해서
- DB dialect 활용해서 DB에 맞는 적절한 DDL을 생성
- 이렇게 생성된 DDL은 개발 장비에서만 사용
- 생성된 DDL은 적절히 다음은 후에 사용
- `@Column(unique = True, length = 10)` 과 같이 필드 단위 DDL 도 가능

### 속성

- persistence.xml에 `<property name="hibernate.hbm2ddl.auto" value="create" />` 를 설정
- create
  - 시작시 drop 테이블하고 create 로 다시 만듦
- create-drop
  - create와 같고 종료 시 테이블 삭제
- update
  - 테이블 삭제안하고 컬럼 추가를 해줌
  - 삭제는 안함
- validate
  - 엔티티와 테이블이 정상 매핑되었는지 확인용
- none
  - ddl 사용 안함

```sql title="hivernate.hbm2ddl.auto 를 create로 설정했을 때"
Hibernate: 
    
    drop table USER if exists
Hibernate: 
    
    create table USER (
       id bigint not null,
        name varchar(255),
        primary key (id)
    )
```

### DDL 옵션 사용 시 주의사항

- `운영장비에선 절대 create, create-drop, update 사용 XXXXXXXXX`
- 개발 초기 create, update
- 테스트 서버 (update), validate (공용 개발 서버)
- 스테이징과 운영 서버는 validate, none

## 필드와 컬럼 매핑

### 필드 종류

#### `@Column`

- name: 테이블 컬럼 이름
- insertable, updatable: 등록 변경 가능 여부 (기본 TRUE)
- nullable(DDL): false면 NOT NULL 제약 조건 걸림 (기본 TRUE)
- unique(DDL): 이름이 랜덤으로 나옴, 그래서 잘 안씀
  - @Table annotation으로 uniqueConstraints 옵션을 주로사함
- columnDefinition: 컬럼 정보를 직접 줄 수 있음
- length(DDL): 문자열 제한
- precision, scale(DDL): BigInteger에 주로 사용

#### `@Enumerated`

- value
  - ORDINAL (default): enum 순서를 DB에 저장 (왜 안되는가?)
    - 데이터 마이그레이션이 필요하게 되버림 (쓰지않는 것을 권장)
  - STRING : enum 이름을 DB에 저장
    - DB 성능이 걱정될 수 있지만 요즘 성능이 좋아 걱정안해도 됨

#### `@Temporal`

- LocalDateTime, LocalDate 를 최신 하이버네이트 지원하기 때문에 `@Temporal`을 안써도 됨

#### `@Lob`

- clob: 필드 타입이 String일 때
- blob: 필드 타입이 Byte일 때

#### `@Transient`

- 매핑안하고 앱에서 엔티티 객체에 메모리에서만 사용할 때

## 기본 키 매핑

## 실전 예제 - 1. 요구사항 분석과 기본 매핑