---
id: '11'
title: 11. API 리팩터링
---

## 11.1 질의 함수와 변경 함수 분리하기

<details>

```java
// before
public long getTotalOutstandingAndSendBill() {
  long result = customer.getInvoices()
      .stream()
      .mapToLong(Invoice::getAmount)
      .sum();
  emailGateway.send(formatBill(customer));
  return result
}

// after
public long getTotalOutstanding() {
  return customer.getInvoices()
      .stream()
      .mapToLong(Invoice::getAmount)
      .sum();
}

public void sendBill() {
  emailGateway.send(formatBill(customer));
}
```

- 겉보기 부수효과(observable side effect)가 전혀 없이 값을 반환해주는 함수를 추구해야 함
  - 겉보기 부수효과: 데이터 값이 변경되는 것, 외부로 입출력이 있는 것
  - 언제 어디서든 호출되도 문제가 없음
  - 명령-질의 분리(command-query separation) 라고도 함

</details>

## 11.2 매개 변수화하기

<details>

```java
// before
public void raiseSalaryTenPercent() {
  this.salary = this.salary.multiply(1.1);
}
public void raiseSalaryFivePercent() {
  this.salary = this.salary.multiply(1.05);
}

// after
public void raiseSalary(double factor) {
  this.salary = this.salary.multiply(factor);
}
```

- 리터럴 값만 다른 함수가 있다면 매개변수화 해서 함수의 재사용성을 늘리는 전략

</details>

## 11.3 플래그 인수 제거하기

<details>

```java
// before
public void setDimension(String name, double value) {
  if (name.equals("height")) {
    this.height = value;
    return;
  }
  if (name.equals("width")) {
    this.width =  value;
    return;
  }
}

// after
public void setHeight(double value) {
  this.height = value;
}
public void setWidth(double value) {
  this.width = value;
}
```

- 인자에 boolean, enum, string이 들어가면 의심해 볼 수 있음
- 플래그 인수는 호출 할 수 있는 함수가 무엇이고 어떻게 해야하는지 파악이 어려워짐
- 플래그 인수가 둘 이상이면 함수 하나가 너무 많은 일을 하고 있다는 신호

</details>

## 11.4 객체 통째로 넘기기

## 11.5 매개변수를 질의 함수로 바꾸기

## 11.6 질의 함수를 매개변수로 바꾸기
